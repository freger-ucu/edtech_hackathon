{% extends 'base.html' %}
{% block title %}Task: {{ task.name }}{% endblock %}
{% block content %}
<h2>Task: {{ task.name }}</h2>
<a href="/subject/{{ task.subject.id }}/">← До предмета</a>
<p>{{ task.description }}</p>
<h3>Leaderboard:</h3>
<ul>
    {% for entry in leaderboard %}
        <li>{{ entry.user.username }}: {{ entry.percent }}% ({{ entry.completed }}/{{ entry.total }})</li>
    {% endfor %}
</ul>
<h3>Subtasks:</h3>
<ul>
    {% for subtask in subtasks %}
        <li>
            <form method="post" style="display:inline;">
                {% csrf_token %}
                <input type="hidden" name="toggle_subtask" value="{{ subtask.id }}">
                <input type="checkbox" onchange="this.form.submit()" {% if subtask.id in completed_subtasks %}checked{% endif %}>
                <span onclick="showModal('{{ subtask.name|escapejs }}', '{{ subtask.description|escapejs }}')" style="cursor:pointer;text-decoration:underline;">{{ subtask.name }}</span>
            </form>
            <form method="post" action="/subtask/{{ subtask.id }}/delete/" style="display:inline;">
                {% csrf_token %}
                <button type="submit">Видалити</button>
            </form>
        </li>
    {% empty %}
        <li>No subtasks yet.</li>
    {% endfor %}
</ul>
<form method="post">
    {% csrf_token %}
    <input type="hidden" name="create_subtask" value="1">
    <input type="text" name="name" placeholder="Subtask name">
    <input type="text" name="description" placeholder="Description">
    <button type="submit">Додати підзавдання</button>
</form>
<!-- Modal for subtask description -->
<div id="subtaskModal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.4);">
  <div style="background:#fff; margin:10vh auto; padding:20px; border-radius:8px; width:90%; max-width:400px; position:relative;">
    <span id="closeModalBtn" style="position:absolute; right:10px; top:10px; cursor:pointer; font-size:24px;">&times;</span>
    <h4 id="modalTitle"></h4>
    <p id="modalDesc"></p>
  </div>
</div>
<script>
function showModal(title, desc) {
    document.getElementById('modalTitle').innerText = title;
    document.getElementById('modalDesc').innerText = desc;
    document.getElementById('subtaskModal').style.display = 'block';
}
document.getElementById('closeModalBtn').onclick = function() {
    document.getElementById('subtaskModal').style.display = 'none';
};
window.onclick = function(event) {
    var modal = document.getElementById('subtaskModal');
    if (event.target == modal) { modal.style.display = 'none'; }
}
</script>
{% endblock %} 