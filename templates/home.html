{% extends 'base.html' %}
{% block title %}Home{% endblock %}
{% block content %}
<h2>Welcome, {{ request.user.username }}!</h2>
<form method="post" action="/logout/">
    {% csrf_token %}
    <button type="submit">Вийти з акаунту</button>
</form>
<h3>Your groups:</h3>
<ul>
    {% for group in groups %}
        <li>
            <a href="/group/{{ group.id }}/">{{ group.name }}</a>
            <ul>
                {% for user in group.users.all %}
                    <li>{{ user.username }}</li>
                {% endfor %}
            </ul>
        </li>
    {% empty %}
        <li>No groups yet.</li>
    {% endfor %}
</ul>
<a href="/create_group/">Create new group</a>
<h3>Всі дедлайни:</h3>
<ul>
    {% for task in tasks %}
        <li>
            <a href="/task/{{ task.id }}/">{{ task.name }}</a>
            ({{ task.subject.name }} / {{ task.subject.group.name }}) —
            {% if task.deadline %}
                <span class="deadline-timer" data-deadline="{{ task.deadline|date:'c' }}"></span>
            {% else %}
                без дедлайну
            {% endif %}
        </li>
    {% empty %}
        <li>Немає дедлайнів.</li>
    {% endfor %}
</ul>
<script>
function updateTimers() {
    const timers = document.querySelectorAll('.deadline-timer');
    timers.forEach(function(timer) {
        const deadline = new Date(timer.getAttribute('data-deadline'));
        const now = new Date();
        const diff = deadline - now;
        if (diff > 0) {
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
            const minutes = Math.floor((diff / (1000 * 60)) % 60);
            const seconds = Math.floor((diff / 1000) % 60);
            timer.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s left`;
        } else {
            timer.textContent = "⏰ Deadline passed";
        }
    });
}
setInterval(updateTimers, 1000);
updateTimers();
</script>
{% endblock %} 